# WebRTC 画面分辨率策略说明

XXTCloudControl 的 WebRTC 画面传输采用了**动态智能自适应**策略，旨在兼顾画质清晰度与传输效率（带宽/发热）。

## 1. 核心逻辑

系统根据以下两个因素的**最小值**实时计算并向设备请求视频流缩放比例：

*   **用户设置的上限 (Maximum Quality Limit)**：通过 UI 侧边栏的“最高分辨率”滑块设置（默认 60%）。
*   **当前显示区域的需求 (Display Fit Scale)**：系统通过 `ResizeObserver` 实时检测前端视频容器的像素尺寸，计算出能够充满该容器且不产生多余像素浪费的最小缩放比例。

**公式：**
`RequestedScale = min(UserLimit, max(DisplayWidth / NativeWidth, DisplayHeight / NativeHeight))`

## 2. 策略特性

*   **动态调整**：当你缩放浏览器窗口、切换全屏或隐藏侧边栏时，前端会自动重新计算并发送 `setResolution` 命令给设备。
*   **旋转自适应**：系统会考虑设备的当前旋转状态（0°/90°/180°/270°），自动交换宽高计算逻辑，确保在横竖屏切换时分辨率依然准确。
*   **按需带宽**：
    *   **小窗口模式**：如果你在小窗口查看，设备会自动切换到低分辨率编码，大幅降低上行带宽占用和设备端负载。
    *   **大窗口模式**：当你放大窗口，系统会自动提升像素，确保在用户设置的上限内提供最清晰的 1:1 像素映射。

## 3. UI 交互

*   **实时监控**：在 WebRTC 控制页面的底部统计栏中，可以看到 **📺 图标**。它实时显示了当前接收到的原始视频流分辨率（例如 `375x667`）。
*   **即时生效**：滑块控件在直播过程中保持开启，任何调整都会即时应用到当前会话。

## 4. 技术实现

主要涉及以下代码组件：
*   `WebRTCControl.tsx`: 实现 `ResizeObserver` 监听、缩放逻辑计算及 `createMemo` 响应式更新。
*   `WebRTCService.ts`: 提供 `setResolution` 接口，用于向后端/设备同步最新的缩放指令。
